#### Сброс пароля с помощью загрузки в однопользовательском режиме.

Сброс пароля root в CentOS 7 и RHEL 7

В однопользовательском режиме система запускает однопользовательскую оболочку, в которой вы можете запускать команды без каких-либо учетных данных (имя пользователя и пароль), вы попадаете прямо в ограниченную оболочку с доступом ко всей файловой системе.

В CentOS 7 и RHEL 7 порядок получения доступа к системе во время процесса загрузки и изменения пароля root изменился из-за принятия Systemd.

![image](https://github.com/user-attachments/assets/36aac2c8-772d-4cd4-a77d-9da8aae2a137)

В начале процесса загрузки в меню GRUB нажмите на клавиатуре клавишу «e» для редактирования.

Затем перейдите к строке ядра (строка, начинающаяся с linux) и измените строку с параметром ``ro``. Замените ``ro`` на ``rw init=/sysroot/bin/sh``

![image](https://github.com/user-attachments/assets/9ec8f8a3-b116-4178-847a-4e22b6b6668f)

а также добавьте следующие операторы в конце: ``rd.break enforcing=0``

Примечание: ``rd.break`` запрашивает перерыв на ранней стадии процесса загрузки.

``enforcing = 0`` переводит систему в разрешающий режим SELinux. Не путайте с selinux = 0, который полностью отключает SELinux.

Нажмите Ctrl + X, чтобы возобновить процесс загрузки.

Выполните команду chroot в разделе ``/sysroot``:
```bash
~# chroot /sysroot
```
Войдите в систему как пользователь root и введите следующую команду, чтобы изменить пароль пользователя root файле /etc/passwd.
```bash
# passwd root
```
![image](https://github.com/user-attachments/assets/badad8c8-12a0-4966-b5c9-01d643bccced)
```bash
# reboot
```
#### Сброс пароля root в CentOS 6 и RHEL 6.

При загрузке нажмите кнопку «e»для редактирования параметров загрузки.

С помощью клавиш вверх/вниз на клавиатуре выберите второй пункт «kernel /vmlinuz» и нажмите на клавиатуре «e».

Появится возможность отредактировать параметры загрузки. Для загрузки CentOS 6 в режиме single mode допишите через пробел в конец строки с параметрами ‘s’ или ‘single’ как показано на следующем скриншоте.

После нажмите Enter, а потом выберите загрузку операционной системы в этом режиме, выбрав его с помощью вверх/вниз и нажав «b» на клавиатуре.

С помощью «passwd» установите новый пароль. В случае успешного выполнения операции появится сообщение:

Passwd: all authentication tokens updated successfully.

![image](https://github.com/user-attachments/assets/a36cf442-69fc-41fe-ae8b-5f4b79026f84)

Защита однопользовательского режима

Если злоумышленник может иметь физический доступ к серверу, он также сможет выбрать ядро для загрузки из пункта меню grub, просто нажав клавишу «e» на клавиатуре, чтобы изменить параметр загрузки ro и загрузиться в однопользовательском режиме на CentOS  без запроса пароля пользователя root, даже если строка SINGLE=/sbin/sushell заменена на SINGLE=/sbin/sulogin в файле /etc/sysconfig/init. Единственный способ защитить паролем однопользовательский режим в CentOS  — это защитить GRUB паролем, используя следующие инструкции.

Как защитить паролем Grub в CentOS

Сначала создайте надежный зашифрованный пароль с помощью утилиты grub2-setpassword
```bash
# grub2-setpassword
```
Хеш для пароля хранится в /boot/grub2/user.cfg , user, то есть «root» определен в файле 
```bash
/boot/grub2/grub.cfg
```
Теперь откройте файл /boot/grub2/grub.cfg и найдите загрузочную запись, которую вы хотите защитить паролем, она начинается с menuentry . Когда запись —unrestricted , удалите из —unrestricted параметр —unrestricted .

Сохраните файл и закройте, теперь попробуйте перезагрузить CentOS  и измените загрузочные записи, нажав клавишу e , вам будет предложено предоставить учетные данные, как показано на скриншоте. GRUB-меню CentOS  успешно защищено паролем.

2) Сброс пароля root помощью редактирования файла /etc/passwd

Если у вас установлена 32 битная ОС, вам потребуется загрузочный диск с Linux  x32 и наоборот. Загрузитесь с Live-диска или установите жесткий диск, где установлена система с забытым паролем в другой компьютер с ОС Linux.

Создайте поддиректорию
```bash
# mkdir /mnt/centos
```
Определите системный диск (sda1, sda2). Утилита fdisk выведет информацию о существующих  разделах диска.
```bash
#fdisk -l
```
Смонтируйте системный раздел:
```bash
# mount /dev/sda2 /mnt/centos
```
Необходимо изменить файл /mnt/centos/etc/shadow, удалив из него хэш пароля пользователя root
```bash
# sudo vi /mnt/centos/etc/shadow
```

